<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS Mockup GitHub Edition</title>
    <style>
        :root {
            --app-size: 60px;
            --app-gap: 20px;
            --col-count: 4;
            --row-count: 6;
            --page-padding: 20px;
            --text-color: white;
        }

        body {
            background-color: #1e1e1e;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro", "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
        }

        /* --- Controls UI --- */
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            font-size: 14px;
            transition: 0.2s;
        }

        .btn:hover { background: rgba(255, 255, 255, 0.4); }
        .btn.active { background: rgba(50, 200, 50, 0.6); border-color: #4f4; }
        .btn.locked { background: rgba(200, 50, 50, 0.6); border-color: #f44; }

        /* --- Phone Frame --- */
        .phone-frame {
            width: 402px;
            height: 874px;
            position: relative;
            overflow: hidden;
            border-radius: 48px;
            box-shadow: 0 0 0 10px #000, 0 0 50px rgba(0,0,0,0.5);
            background: black;
            display: flex;
            flex-direction: column;
        }

        .wallpaper {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            /* –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–æ–∏, –µ—Å–ª–∏ –Ω–µ—Ç - –≥—Ä–∞–¥–∏–µ–Ω—Ç */
            background-image: url('wallpaper.jpg'), url('wallpaper.png'), linear-gradient(135deg, #1c1c1e, #3a3a3c);
            background-size: cover;
            background-position: center;
            z-index: 0;
        }

        .status-bar {
            height: 44px;
            width: 100%;
            position: relative;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding-bottom: 5px;
            box-sizing: border-box;
            color: white;
            font-weight: 600;
            font-size: 16px;
            padding-left: 30px;
            padding-right: 30px;
        }

        .pages-container {
            flex: 1;
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            z-index: 5;
            padding-top: 20px;
        }
        .pages-container::-webkit-scrollbar { display: none; }

        .page {
            min-width: 100%;
            height: 100%;
            scroll-snap-align: start;
            display: grid;
            grid-template-columns: repeat(var(--col-count), 1fr);
            grid-template-rows: repeat(var(--row-count), auto);
            align-content: start;
            padding: 0 20px;
            box-sizing: border-box;
            row-gap: 20px;
        }

        .app-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            position: relative;
            user-select: none;
            -webkit-user-drag: none;
            touch-action: none;
        }

        .app-icon {
            width: var(--app-size);
            height: var(--app-size);
            border-radius: 14px;
            background: #333;
            overflow: hidden;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            pointer-events: none;
        }

        .app-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .app-name {
            font-size: 11px;
            color: var(--text-color);
            text-align: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            max-width: 70px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .app-item.shaking { animation: shake 0.3s infinite ease-in-out; }
        .app-item.dragging { opacity: 0.5; transform: scale(1.1); z-index: 100; }

        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(1.5deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-1.5deg); }
            100% { transform: rotate(0deg); }
        }

        .dock-wrapper { padding: 15px; z-index: 10; }
        .dock {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(25px);
            border-radius: 35px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 15px 10px;
            height: 90px;
            box-sizing: border-box;
        }
        
        .dots { display: flex; justify-content: center; gap: 8px; padding-bottom: 10px; z-index: 10; }
        .dot { width: 8px; height: 8px; background: rgba(255,255,255,0.3); border-radius: 50%; }
        .dot.active { background: white; }

        /* Loading Spinner */
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-family: sans-serif;
            background: rgba(0,0,0,0.7); padding: 20px; border-radius: 10px;
            z-index: 2000; display: none;
        }
    </style>
</head>
<body>

    <div class="controls">
        <button id="lockBtn" class="btn locked">üîí Locked</button>
        <button id="downloadBtn" class="btn">–°–∫–∞—á–∞—Ç—å order.json</button>
        <label for="uploadInput" class="btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å order.json</label>
        <input type="file" id="uploadInput" accept=".json,.txt" style="display: none;">
    </div>

    <div class="phone-frame">
        <div id="loading">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ GitHub...</div>
        <div class="wallpaper"></div>
        
        <div class="status-bar">
            <span>9:41</span>
            <div style="display: flex; gap: 5px;">
                <div style="width: 18px; height: 12px; background: white; -webkit-mask: url('data:image/svg+xml;utf8,<svg viewBox=\'0 0 24 24\' xmlns=\'http://www.w3.org/2000/svg\'><path d=\'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z\'/></svg>') no-repeat center;"></div>
                <div style="width: 20px; height: 12px; border: 1px solid rgba(255,255,255,0.5); border-radius: 4px; position: relative;">
                    <div style="background: white; width: 14px; height: 8px; margin: 1px;"></div>
                </div>
            </div>
        </div>

        <div class="pages-container" id="pagesContainer"></div>
        <div class="dots" id="dotsContainer"></div>

        <div class="dock-wrapper">
            <div class="dock" id="dockContainer"></div>
        </div>
    </div>

    <script>
        // ==========================================
        // –ù–ê–°–¢–†–û–ô–ö–ò GITHUB (–ó–ê–ü–û–õ–ù–ò –≠–¢–û!)
        // ==========================================
        const GITHUB_USERNAME = 'cursorus'; // –¢–≤–æ–π –ª–æ–≥–∏–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä 'ivanov'
        const GITHUB_REPO = 'ios';    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä 'ios-mockup'
        const FOLDER_PATH = 'images';            // –ü–∞–ø–∫–∞, –≥–¥–µ –ª–µ–∂–∞—Ç –∏–∫–æ–Ω–∫–∏
        // ==========================================

        const dockConfig = ['icon1', 'icon2', 'icon3', 'icon4']; 
        
        let appState = []; 
        let isEditMode = false;
        let dragSrcEl = null;
        let dragSrcIndex = -1;

        // --- GITHUB FETCH LOGIC ---

        async function fetchImagesFromGitHub() {
            const loadingEl = document.getElementById('loading');
            loadingEl.style.display = 'block';

            const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${FOLDER_PATH}`;
            
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ GitHub API: ${response.status}`);
                
                const data = await response.json();
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏ (png, jpg, jpeg)
                const imageFiles = data.filter(file => 
                    file.type === 'file' && 
                    /\.(png|jpg|jpeg)$/i.test(file.name)
                );

                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –Ω–∞—à —Ñ–æ—Ä–º–∞—Ç
                appState = imageFiles.map((file, index) => {
                    return {
                        id: `app-${index}`,
                        fileName: file.name,
                        displayName: parseName(file.name),
                        src: file.download_url // GitHub API –æ—Ç–¥–∞–µ—Ç –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É
                    };
                });

                render();

            } catch (error) {
                console.error(error);
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å GitHub. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å (F12) –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ USERNAME/REPO –≤ –∫–æ–¥–µ.");
                // Fallback (–∑–∞–≥–ª—É—à–∫–∞), —á—Ç–æ–±—ã —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ –ø–æ–∫–∞–∑–∞–ª–æ—Å—å
                appState = [];
                render();
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        function parseName(filename) {
            let namePart = filename.substring(0, filename.lastIndexOf('.'));
            let parts = namePart.split('_');
            if (parts.length > 1) {
                parts.shift();
                return parts.join(' ');
            } else {
                return namePart;
            }
        }

        // --- RENDER & LOGIC ---

        const APPS_PER_PAGE = 24;

        function render() {
            const container = document.getElementById('pagesContainer');
            const dotsContainer = document.getElementById('dotsContainer');
            container.innerHTML = '';
            dotsContainer.innerHTML = '';

            const pageCount = Math.ceil(appState.length / APPS_PER_PAGE) || 1;
            
            for (let i = 0; i < pageCount; i++) {
                const dot = document.createElement('div');
                dot.className = `dot ${i === 0 ? 'active' : ''}`;
                dotsContainer.appendChild(dot);

                const page = document.createElement('div');
                page.className = 'page';
                
                const start = i * APPS_PER_PAGE;
                const end = start + APPS_PER_PAGE;
                const pageApps = appState.slice(start, end);

                pageApps.forEach((app, localIndex) => {
                    const globalIndex = start + localIndex;
                    page.appendChild(createAppElement(app, globalIndex));
                });

                container.appendChild(page);
            }

            container.onscroll = () => {
                const pageIndex = Math.round(container.scrollLeft / container.clientWidth);
                Array.from(dotsContainer.children).forEach((d, idx) => {
                    d.classList.toggle('active', idx === pageIndex);
                });
            };
        }

        function createAppElement(app, index) {
            const div = document.createElement('div');
            div.className = `app-item ${isEditMode ? 'shaking' : ''}`;
            div.dataset.index = index;
            div.draggable = isEditMode;

            if (isEditMode) {
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragover', handleDragOver);
                div.addEventListener('drop', handleDrop);
                div.addEventListener('dragend', handleDragEnd);
                div.addEventListener('touchstart', handleTouchStart, {passive: false});
                div.addEventListener('touchmove', handleTouchMove, {passive: false});
                div.addEventListener('touchend', handleTouchEnd);
            }

            const img = new Image();
            img.src = app.src;
            img.onerror = function() { this.src = 'https://placehold.co/60x60?text=Error'; };

            div.innerHTML = `
                <div class="app-icon"></div>
                <div class="app-name">${app.displayName}</div>
            `;
            div.querySelector('.app-icon').appendChild(img);

            return div;
        }

        function renderDock() {
            const dock = document.getElementById('dockContainer');
            dock.innerHTML = '';
            dockConfig.forEach((iconName, i) => {
                const div = document.createElement('div');
                div.className = 'app-item';
                div.innerHTML = `
                    <div class="app-icon" style="width: 60px; height: 60px;">
                        <img src="${iconName}.png" onerror="this.src='${iconName}.jpg'; if(this.src.endsWith('.jpg')) this.onerror=null; else this.src='https://placehold.co/60x60?text=${i+1}'">
                    </div>
                `;
                dock.appendChild(div);
            });
        }

        // --- DRAG & DROP ---

        function handleDragStart(e) {
            dragSrcEl = this;
            dragSrcIndex = parseInt(this.dataset.index);
            e.dataTransfer.effectAllowed = 'move';
            this.classList.add('dragging');
        }
        function handleDragOver(e) { if (e.preventDefault) e.preventDefault(); return false; }
        function handleDrop(e) {
            if (e.stopPropagation) e.stopPropagation();
            const target = e.target.closest('.app-item');
            if (dragSrcEl !== target && target) {
                reorderApps(dragSrcIndex, parseInt(target.dataset.index));
            }
            return false;
        }
        function handleDragEnd(e) { this.classList.remove('dragging'); }

        // Touch
        let touchEl = null, touchClone = null;
        function handleTouchStart(e) {
            if (!isEditMode) return;
            touchEl = this;
            dragSrcIndex = parseInt(this.dataset.index);
            const rect = this.getBoundingClientRect();
            touchClone = this.cloneNode(true);
            Object.assign(touchClone.style, {
                position: 'fixed', top: rect.top+'px', left: rect.left+'px', 
                opacity: '0.8', zIndex: '1000', pointerEvents: 'none'
            });
            touchClone.classList.remove('shaking');
            document.body.appendChild(touchClone);
            this.style.opacity = '0';
        }
        function handleTouchMove(e) {
            if (!touchClone) return;
            e.preventDefault();
            const t = e.touches[0];
            touchClone.style.left = (t.clientX - 30) + 'px';
            touchClone.style.top = (t.clientY - 30) + 'px';
        }
        function handleTouchEnd(e) {
            if (!touchClone) return;
            const t = e.changedTouches[0];
            touchClone.remove(); touchClone = null;
            touchEl.style.opacity = '1';
            touchEl.style.display = 'none';
            let target = document.elementFromPoint(t.clientX, t.clientY);
            touchEl.style.display = 'flex';
            if (target) {
                const app = target.closest('.app-item');
                if (app && app !== touchEl) reorderApps(dragSrcIndex, parseInt(app.dataset.index));
            }
        }

        function reorderApps(from, to) {
            const item = appState.splice(from, 1)[0];
            appState.splice(to, 0, item);
            render();
        }

        // --- CONTROLS ---

        const lockBtn = document.getElementById('lockBtn');
        lockBtn.addEventListener('click', () => {
            isEditMode = !isEditMode;
            lockBtn.textContent = isEditMode ? 'üîì Unlocked' : 'üîí Locked';
            lockBtn.classList.toggle('active', isEditMode);
            lockBtn.classList.toggle('locked', !isEditMode);
            render();
        });

        document.getElementById('downloadBtn').addEventListener('click', () => {
            const orderList = appState.map(app => app.fileName);
            const blob = new Blob([JSON.stringify(orderList, null, 2)], {type: 'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'order.json';
            a.click();
        });

        document.getElementById('uploadInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const loadedNames = JSON.parse(e.target.result);
                    // –ü–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞–µ–º appState –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–µ–Ω –∏ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å GitHub
                    // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º map —Ç–µ–∫—É—â–∏—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö
                    const currentMap = new Map(appState.map(app => [app.fileName, app]));
                    const newState = [];
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø–æ—Ä—è–¥–∫–µ –∏–∑ —Ñ–∞–π–ª–∞
                    loadedNames.forEach(name => {
                        if (currentMap.has(name)) {
                            newState.push(currentMap.get(name));
                            currentMap.delete(name);
                        }
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ/–æ—Å—Ç–∞–≤—à–∏–µ—Å—è
                    currentMap.forEach(val => newState.push(val));
                    
                    appState = newState;
                    render();
                } catch (err) { alert('–û—à–∏–±–∫–∞ JSON'); }
            };
            reader.readAsText(file);
        });

        // --- INIT ---
        renderDock();
        // –í–ê–ñ–ù–û: –ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è GitHub
        fetchImagesFromGitHub();

    </script>
</body>
</html>
